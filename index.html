<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willy2Go</title>
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>

    <style>
        body {
            font-family: Roboto Mono;
            background-color: #4B0082;
            color: #FFD700;
            margin: 0;
            padding: 0;
        }

        header {
            text-align: center;
            padding: 7px;
            background-color: #6A0DAD;
            border-radius: 15px;
            color: #efbf04;
        }

        header h1 {
            margin: 0;
            text-align: center;
            font-family: Montserrat
        }

        header img.align-left {
            position: absolute;
            left: 15px;
            top: 35px;
        }

        header img.align-right {
            position: absolute;
            right: 15px;
            top: auto;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #E6E6FA;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .container h2 {
            color: #4B0082;
            border-radius: 10px;
        }

        .header-image {
            background-color: transparent;
            /* Removes background */
            border: none;
            /* Removes any borders */
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            /* Add spacing between the images */
            margin-top: 10px;
            /* Space between the text and the images */
        }

        #cartItems {
            list-style: none;
            /* Remove bullets */
            padding: 0;
            /* Remove left indentation */
            margin: 0;
            color: #4B0082;
            /* Ensure no extra space */
            font-size: 20px;
        }

        #cartItems div {
            text-align: left;
            /* Ensure text aligns to the left */
            margin-bottom: 5px;
            /* Optional: Add space between items */
        }

        .menu-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .menu-table th,
        .menu-table td {
            border: none;
            /* Remove borders */
            padding: 10px;
            text-align: center;
            font-family: Inter;
        }

        .menu-table th {
            background-color: #6A0DAD;
            color: #FFD700;
            font-family: Inter;
        }

        .menu-table th:nth-child(3),
        .menu-table td:nth-child(3) {
            width: 200px;
            /* Set a fixed width for the Quantity column */
        }

        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-group label {
            flex: 2;
            margin-bottom: 5px;
            color: #4B0082;
            font-family: Georgia;
        }

        .quantity-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center align the buttons and input */
            gap: 5px;
            /* Add consistent spacing between buttons and input */
        }

        .quantity-wrapper button {
            width: 30px;
            height: 30px;
            background-color: #FFD700;
            border: none;
            border-radius: 5px;
            color: #4B0082;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .quantity-wrapper button:hover {
            background-color: #E6BE8A;
        }

        .quantity-wrapper input {
            width: 50px;
            text-align: center;
            padding: 5px;
            border: 1px solid #6A0DAD;
            border-radius: 5px;
            font-size: 16px;
            color: #4B0082;
            margin: 0 5px;
        }

        #cartItems li {
            color: #4B0082;
            /* Purple color */
            font-family: Georgia;
        }

        .menu-table td {
            color: #4B0082;
            /* Purple color */
            font-family: Inter;
        }

        .quantity-wrapper input::placeholder {
            color: gray;
            /* Placeholder color */
            text-align: center;
            /* Center placeholder text */
        }

        .quantity-wrapper input[type="number"] {
            appearance: textfield;
            /* Removes number spinner for better alignment */
        }

        .quantity-wrapper input[type="number"]::-webkit-inner-spin-button,
        .quantity-wrapper input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            /* Hides spinner in Chrome, Safari, Edge */
            margin: 0;
            /* Ensures no extra margin is applied */
            font-family: Inter;
        }

        #totalCost {
            font-size: 1.5rem;
            color: #4B0082;
            text-align: center;
            margin-top: 15px;
        }

        .submit-btn {
            width: 100%;
            padding: 10px;
            background-color: #FFD700;
            color: #4B0082;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background-color: #E6BE8A;
        }

        select {
            flex: 0.6;
            width: 100%;
            /* Adjust width */
            height: 28px;
            /* Adjust height */
            padding: 5px;
            /* Add padding for better appearance */
            border: 1px solid gray;
            border-radius: 5px;
            font-size: 13px;
            /* Control text size within the dropdown */
            color: gray;
            /* Text color */
            background-color: #FFFFFF;
            /* Background color */
            font-family: Georgia;
        }

        select:focus,
        select:valid {
            color: black;
        }

        footer {
            text-align: center;
            padding: 10px;
            margin-top: 20px;
            background-color: #6A0DAD;
            color: #FFD700;
        }
    </style>
</head>

<body>
    <header>
        <div class="image-container">
            <img src="images/PurpleWilly.png" alt="WillyGo Logo" class="header-image" style="width:250px; height: auto;">
        </div>
        <h4 style>Order your McDonald's favorites in seconds!</h4>
    </header>

    <div class="container">
        <header>
            <h1 style="font-family:Montserrat"> Enter Your Order</h1>
        </header>
        <div class="image-container">
            <img src="images/McDonalds.jpg" alt="McDonald's Logo" class="header-image" style="width:130px; height: auto;">
        </div>
        <div style="display: flex; justify-content: center; gap: 50px;">
            <div style="font-family: Inter; color: #6A0DAD; text-align: left; font-size: 26px;">
                <h3>Open:</h3>
                <h4 style="font-size: 22px;">Friday: 8:00 PM - 2:30 AM</h4>
                <h4 style="font-size: 22px;">Saturday: 8:00 PM - 2:30 AM</h4>
            </div>

            <div style="font-family: Inter; color: #6A0DAD; text-align: left; font-size: 26px;">
                <h3>Add delivery explanation section</h3>
                <h4 style="font-size: 22px;">Deliveries are made within ...</h4>
                <h4 style="font-size: 22px;">*will send you what to put in this section*</h4>
            </div>
        </div>
        <hr>
        <div class="form-group">
            <label for="Name" style="font-family: Inter;">Name:</label>
            <input placeholder="Enter Name">
        </div>
        <div class="form-group">
            <label for="Dorm" style="font-family: Inter;">Residence:</label>
            <select style="font-family: Inter;" id="Dorm" name="Dorm" required>
                <option value="" disabled selected>Select Your Residence</option>
                <option value="Agard">Agard</option>
                <option value="Brooks">Brooks</option>
                <option value="Bryant">Bryant</option>
                <option value="Carter">Carter</option>
                <option value="Currier">Currier</option>
                <option value="Dodd">Dodd</option>
                <option value="East">East</option>
                <option value="Fayerweather">Fayerweather</option>
                <option value="Fitch">Fitch</option>
                <option value="Garfield">Garfield</option>
                <option value="Gladden">Gladden</option>
                <option value="Goff's">Goff's</option>
                <option value="Goodrich">Goodrich</option>
                <option value="Horn">Horn</option>
                <option value="Hubbell">Hubbell</option>
                <option value="Images">Images</option>
                <option value="Lehman">Lehman</option>
                <option value="Mark Hopkins">Mark Hopkins</option>
                <option value="Mission">Mission</option>
                <option value="Morgan">Morgan</option>
                <option value="Perry">Perry</option>
                <option value="Prospect">Prospect</option>
                <option value="Sage">Sage</option>
                <option value="Sewall">Sewall</option>
                <option value="Sushi Thai">Sushi Thai</option>
                <option value="Spencer">Spencer</option>
                <option value="Thompson">Thompson</option>
                <option value="Tyler">Tyler</option>
                <option value="Tyler Annex">Tyler Annex</option>
                <option value="West">West</option>
                <option value="Willy">Williams (Willy)</option>
                <option value="Wood">Wood</option>
                <option value="66 Hoxsey">66 Hoxsey</option>
                <option value="70 Hoxsey">70 Hoxsey</option>
                <option value="71 Hoxsey">71 Hoxsey</option>

            </select>

        </div>
        <div class="form-group">
            <label style="font-family: Inter;" for="phoneNumber">Phone Number:</label>
            <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Enter Phone Number" maxlength="16">
        </div>
        <div class="form-group">
          <label style="font-family: Inter;" for="emailAddress">Email:</label>
          <input type="text" id="emailAddress" name="emailAddress" placeholder="Enter Email Address" maxlength="30">
      </div>
        <form id="orderForm" action="/.netlify/functions/create-checkout-session" method="POST">
            <table class="menu-table">
                <tbody>
                    <tr>
                        <td colspan="2"
                            style="font-size: 22px; text-align: left; font-weight: bold; color: #4B0082; background-color: #E6E6FA; padding: 10px; border-radius: 10px;">
                            Burgers
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="images/big_mac.jpeg" alt="Big Mac" width="100" height="100"
                                style="vertical-align: middle;"><br>
                            Big Mac
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('bigMac', -1)">-</button>
                                <input type="number" id="bigMac" name="bigMac" placeholder="0" value="0" min="0"
                                    data-price="5.99" readonly>
                                <button type="button" onclick="adjustQuantity('bigMac', 1)">+</button>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <img src="images/quarter_pounder.jpeg" alt="Quarter Pounder" width="100" height="100"
                                style="vertical-align: middle;"><br>
                            Quarter Pounder
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('quarterPounder', -1)">-</button>
                                <input type="number" id="quarterPounder" name="quarterPounder" placeholder="0" value="0"
                                    min="0" data-price="7.09" readonly>
                                <button type="button" onclick="adjustQuantity('quarterPounder', 1)">+</button>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <img src="images/double_quarter_pounder.jpg" alt="Double Quarter Pounder" width="100" height="100"
                                style="vertical-align: middle;"><br>
                            Double Quarter Pounder
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('doubleQuarterPounder', -1)">-</button>
                                <input type="number" id="doubleQuarterPounder" name="doubleQuarterPounder"
                                    placeholder="0" value="0" min="0" data-price="7.99" readonly>
                                <button type="button" onclick="adjustQuantity('doubleQuarterPounder', 1)">+</button>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <img src="images/mc_crispy.jpg" alt="McCrispy" width="100" height="100"
                                style="vertical-align: middle;"><br>
                            McCrispy
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('mcCrispy', -1)">-</button>
                                <input type="number" id="mcCrispy" name="mcCrispy" placeholder="0" value="0" min="0"
                                    data-price="7.99" readonly>
                                <button type="button" onclick="adjustQuantity('mcCrispy', 1)">+</button>
                            </div>
                        </td>
                    </tr>

                    <tr
                        style="text-align: center; padding: 7px; background-color: #6A0DAD; border-radius: 15px; color: #efbf04;">
                        <td style="color: #efbf04;">Item</td>
                        <td style="color: #efbf04;">Size</td>
                        <td style="color: #efbf04;">Quantity</td>
                    </tr>
                    <tr>
                        <td>
                            <img src="images/french_fries.jpg" alt="fries" width="100" height="100"
                                style="vertical-align: middle;"><br>
                            Fries
                        </td>
                        <td>
                            <select style="font-family: Inter;" id="friesSize"
                                onchange="updatePriceAndQuantity('fries', 'friesSize')">
                                <option value="4.79" data-size="small">Small ($4.79)</option>
                                <option value="5.79" data-size="medium">Medium ($5.79)</option>
                                <option value="7.09" data-size="large">Large ($7.09)</option>
                            </select>
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('fries', -1)">-</button>
                                <input type="number" id="fries" name="fries" placeholder="0" min="0" value="0"
                                    size="small" data-price="4.79" readonly>
                                <button type="button" onclick="adjustQuantity('fries', 1)">+</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <img src="images/mc_nuggets.jpg" alt="McNuggets" width="150" height="100"
                                style="vertical-align: middle;"><br>
                            McNuggets
                        </td>
                        <td>
                            <select id="mcNuggetsSize" style="font-family: Inter;" onchange="updatePriceAndQuantity('mcNuggets', 'mcNuggetsSize')
                            ">
                                <option value="6.79" data-size="4pc">4pc ($6.79)</option>
                                <option value="8.99" data-size="6pc">6pc ($8.99)</option>
                                <option value="9.89" data-size="10pc">10pc ($9.89)</option>
                                <option value="11.89" data-size="20pc">20pc ($11.89)</option>
                            </select>
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('mcNuggets', -1)">-</button>
                                <input type="number" id="mcNuggets" name="mcNuggets" placeholder="0" min="0" value="0"
                                    size="4pc" data-price="6.79" readonly>
                                <button type="button" onclick="adjustQuantity('mcNuggets', 1)">+</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3"
                            style="font-size: 22px;text-align: left; font-weight: bold; color: #4B0082; background-color: #E6E6FA; padding: 10px; border-radius: 10px;">
                            Drinks
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select id="sodaFlavor" style="font-family: Inter;"
                                onchange="updateProductFlavor(soda, sodaFlavor)">
                                <option value="" disabled selected hidden>Soft Drinks</option>
                                <option value="0.99" data-flavor="sprite">Sprite</option>
                                <option value="0.99" data-flavor="cocaCola">Coca Cola</option>
                                <option value="0.99" data-flavor="cokeZero">Coke Zero</option>
                                <option value="0.99" data-flavor="orangeFanta">Orange Fanta</option>
                                <option value="0.99" data-flavor="drPepper">Dr. Pepper</option>
                                <option value="0.99" data-flavor="rootBeer">Root Beer</option>
                                <option value="0.99" data-flavor="lemonade">Lemonade</option>
                            </select>
                        </td>
                        <td>
                            <select id="sodaSize" style="font-family: Inter;"
                                onchange="updatePriceAndQuantity('soda', 'sodaSize')">
                                <option value="2.19" data-size="small">Small ($2.19)</option>
                                <option value="2.49" data-size="medium">Medium ($2.49)</option>
                                <option value="2.59" data-size="large">Large ($2.59)</option>
                            </select>
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('soda', -1)">-</button>
                                <input type="number" id="soda" name="soda" placeholder="0" min="0" value="0" +
                                    size="small" data-price="2.19" data-flavor="cocaCola" readonly>
                                <button type="button" onclick="adjustQuantity('soda', 1)">+</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3"
                            style=" font-size: 22px; text-align: left; font-weight: bold; color: #4B0082; background-color: #E6E6FA; padding: 10px; border-radius: 10px;">
                            Sweets
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select id="mcflurryFlavor" style="font-family: Inter;"
                                onchange="updateProductFlavor(mcflurry, mcflurryFlavor)">
                                <option value="" disabled selected hidden>McFlurry</option>
                                <option value="6.59" data-flavor="oreoMcFlurry">Oreo McFlurry</option>
                                <option value="6.59" data-flavor="m&MMcFlurry">M&M McFlurry</option>
                                <option value="6.59" data-flavor="oreoShamrockMcFlurry">Shamrock Oreo McFlurry</option>
                            </select>
                        </td>
                        <td>
                            <select id="mcflurrySize" style="font-family: Inter;"
                                onchange="updatePriceAndQuantity('mcflurry', 'mcflurrySize')">
                                <option value="6.59" data-size="standard">Standard ($6.59)</option>
                                <option value="4.19" data-size="mini">Mini ($4.19)</option>
                            </select>
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('mcflurry', -1)">-</button>
                                <input type="number" id="mcflurry" name="mcflurry" placeholder="0" min="0" value="0" +
                                    size="standard" data-price="6.59" data-flavor="oreoMcFlurry" readonly>
                                <button type="button" onclick="adjustQuantity('mcflurry', 1)">+</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select id="shakeFlavor" style="font-family: Inter;"
                                onchange="updateProductFlavor(shake, shakeFlavor)">
                                <option value="" disabled selected hidden>Milkshake</option>
                                <option value="5.59" data-flavor="chocolateShake">Chocolate Shake</option>
                                <option value="6.19" data-flavor="vanillaShake">Vanilla Shake</option>
                                <option value="6.59" data-flavor="strawberryShake">Strawberry Shake</option>
                            </select>
                        </td>
                        <td>
                            <select id="shakeSize" style="font-family: Inter;"
                                onchange="updatePriceAndQuantity('shake', 'shakeSize')">
                                <option value="5.59" data-size="small">Small ($5.59)</option>
                                <option value="6.19" data-size="medium">Medium ($6.19)</option>
                                <option value="6.59" data-size="large">Large ($6.59)</option>
                            </select>
                        </td>
                        <td>
                            <div class="quantity-wrapper">
                                <button type="button" onclick="adjustQuantity('shake', -1)">-</button>
                                <input type="number" id="shake" name="shake" placeholder="0" min="0" value="0" +
                                    size="small" data-price="5.59" data-flavor="chocolate" readonly>
                                <button type="button" onclick="adjustQuantity('shake', 1)">+</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3 style="font-family:Georgia;color: #6A0DAD;">Current Cart</h3>
            <ul id="cartItems"></ul>
            <div id="totalCost"></div>
            <hr>
            <button type="button" class="submit-btn" id="checkout-button" onclick="submitOrder(event)">Proceed with Payment</button>
        </form>

    </div>

    <footer>
        <p>Â© 2025 Willy2Go</p>
    </footer>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://checkout.stripe.com/checkout.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        emailjs.init("P-flo4QhLrSH5apSe"); // Replace with your actual EmailJS Public Key
    </script>

    <script>
        // General object to store product quantities
        const cart = {};

        function updateProductFlavor(product, productFlavor) {
            const productFlavorSelect = document.getElementById(productFlavor);
            productFlavorSelect.addEventListener("change", function () {
                const selectedFlavorOption = this.options[this.selectedIndex];
                const flavor = selectedFlavorOption.getAttribute("data-flavor"); // Get selected flavor
                const sodaInput = document.getElementById(product);

                // Update the name attribute dynamically based on flavor
                const newItemId = `${product}_${flavor}`;
                sodaInput.name = newItemId;

                // Fetch the current selected size
                const productSizeSelect = document.getElementById(product + "Size");
                const selectedSizeOption = productSizeSelect.options[productSizeSelect.selectedIndex];
                const size = selectedSizeOption.getAttribute("data-size");

                // Reset quantity to 0 if switching to a new flavor
                if (!(newItemId in cart) || !(size in cart[newItemId])) {
                    sodaInput.value = 0;
                } else {
                    sodaInput.value = cart[newItemId][size].quantity; // Retrieve quantity from cart if exists
                }

                // Ensure cart is structured correctly for new flavor
                if (!(newItemId in cart)) {
                    cart[newItemId] = {};
                }
                if (!(size in cart[newItemId])) {
                    cart[newItemId][size] = { price: parseFloat(selectedSizeOption.value), quantity: 0 };
                }

                // Update price and quantity based on size
                updatePriceAndQuantity(newItemId, product + "Size");
            });
        }

        // Ensure the function runs on page load to initialize correct values
        updateProductFlavor();

        function updatePriceAndQuantity(itemId, itemSizeId) {
            const optionElement = document.getElementById(itemSizeId);
            const selectedOption = optionElement.options[optionElement.selectedIndex];
            const value = parseFloat(selectedOption.value);  // Price of the selected size
            const size = selectedOption.getAttribute('data-size');  // Size (like '10pc', '20pc', etc.)

            const itemElement = document.getElementById(itemId);
            const itemKey = itemElement.name;  // Use the name attribute as the key
            itemElement.setAttribute('data-price', value);  // Update price

            if (!(itemKey in cart)) {
                cart[itemKey] = {};
            }

            // Initialize the size with quantity 0 if not present in cart
            if (!(size in cart[itemKey])) {
                cart[itemKey][size] = { "price": value, "quantity": 0 };
            }

            // Set input field value to the quantity stored in cart
            itemElement.value = cart[itemKey][size].quantity;
        }

        function adjustQuantity(itemId, quantityChange) {
            const inputElement = document.getElementById(itemId);

            // Check if there's an associated flavor dropdown
            const flavorDropdown = document.getElementById(itemId + "Flavor");
            if (flavorDropdown) {
                const selectedFlavorOption = flavorDropdown.options[flavorDropdown.selectedIndex];

                if (!selectedFlavorOption || !selectedFlavorOption.getAttribute("data-flavor")) {
                    alert(`Please select a valid flavor for ${itemId} before adjusting quantity.`);
                    return; // Prevent quantity change
                }
            }

            let currentValue = parseInt(inputElement.value, 10);
            currentValue += quantityChange;
            if (currentValue < 0) {
                currentValue = 0; // Prevent negative values
            }

            inputElement.value = currentValue;
            updateCart(itemId);
        }

        function updateCartDisplay() {
            const cartItemsList = document.getElementById('cartItems');
            cartItemsList.innerHTML = ''; // Clear previous items

            for (let itemKey in cart) {
                const itemData = cart[itemKey];

                if (itemKey === "sauce") {
                    // Display sauce separately
                    const sauceDiv = document.createElement('div');
                    sauceDiv.textContent = `${itemData.quantity}x ${itemData.name} Sauce`;
                    cartItemsList.appendChild(sauceDiv);
                } else if (!('quantity' in itemData)) {
                    // For size-based items like fries and McNuggets
                    for (let size in itemData) {
                        const sizeData = itemData[size];
                        if (sizeData.quantity > 0) {
                            const capitalizedSize = size.charAt(0).toUpperCase() + size.slice(1);
                            const itemDiv = document.createElement('div');
                            itemDiv.textContent = `${capitalizedSize} ${formatItemName(itemKey)}: ${sizeData.quantity} x $${sizeData.price.toFixed(2)}`;
                            cartItemsList.appendChild(itemDiv);
                        }
                    }
                } else {
                    if (itemData.quantity > 0) {
                        const itemDiv = document.createElement('div');
                        itemDiv.textContent = `${formatItemName(itemKey)}: ${itemData.quantity} x $${itemData.price.toFixed(2)}`;
                        cartItemsList.appendChild(itemDiv);
                    }
                }
            }

            updateTotalCost();
        }



        // Helper function to format item names (capitalize first letter)
        function formatItemName(itemKey) {
            // Split the itemKey by underscores (assumed to be in "category_name" format)
            const parts = itemKey.split('_');

            // If the name has multiple parts (e.g., "soda_cocaCola"), remove the first part
            if (parts.length > 1) {
                return parts.slice(1).map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }

            // If the name is a single word (e.g., "bigMac"), just capitalize it
            return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
        }


        function updateCart(itemId) {
            const inputElement = document.getElementById(itemId);
            const quantity = parseInt(inputElement.value, 10) || 0;
            const price = parseFloat(inputElement.getAttribute("data-price")) || 0;

            // Check if the item has a size dropdown (like McNuggets)
            const sizeDropdown = document.getElementById(itemId + "Size");
            let size = "";

            if (sizeDropdown) {
                const selectedSizeOption = sizeDropdown.options[sizeDropdown.selectedIndex];
                size = selectedSizeOption.getAttribute("data-size");

                if (!(itemId in cart)) {
                    cart[itemId] = {};
                }

                cart[itemId][size] = {
                    price: price,
                    quantity: quantity
                };
            } else {
                cart[itemId] = {
                    price: price,
                    quantity: quantity
                };
            }

            updateCartDisplay();

            // Ensure the sauce row updates correctly when McNuggets are changed
            if (itemId === "mcNuggets" || itemId == "fries") {
                handleSauceRow();
            }
        }

        function handleSauceRow() {
            const menuTable = document.querySelector(".menu-table tbody");
            const hasMcNuggets = cart.mcNuggets && Object.values(cart.mcNuggets).some(size => size.quantity > 0);
            const hasFries = cart.fries && Object.values(cart.fries).some(size => size.quantity > 0);
            let sauceRow = document.getElementById("sauceRow");
            let friesSauceRow = document.getElementById("friesSauceRow");

            if (hasMcNuggets || hasFries) {
                if (!sauceRow) {
                    sauceRow = document.createElement("tr");
                    sauceRow.id = "sauceRow";
                    sauceRow.innerHTML = `
                    <td colspan="1">
                        <select id="sauceChoice" onchange="updateSauceCart()">
                            <option value="" disabled selected hidden>Choose a sauce</option>
                            <option value="BBQ">BBQ</option>
                            <option value="Sweet and Sour">Sweet and Sour</option>
                            <option value="Honey Mustard">Honey Mustard</option>
                            <option value="Ranch">Ranch</option>
                            <option value="Buffalo">Buffalo</option>
                        </select>
                    </td>
                    <td>-</td>
                    <td colspan="1">
                        <div class="quantity-wrapper">
                            <button type="button" onclick="adjustSauceQuantity(-1)">-</button>
                            <input type="number" id="sauceQuantity" name="sauceQuantity" placeholder="0" min="0" value="0" readonly>
                            <button type="button" onclick="adjustSauceQuantity(1)">+</button>
                        </div>
                    </td>
                `;
                }

                const referenceRow = hasMcNuggets ? document.getElementById("mcNuggets").closest("tr") : document.getElementById("fries").closest("tr");
                if (referenceRow && referenceRow.nextSibling !== sauceRow) {
                    menuTable.insertBefore(sauceRow, referenceRow.nextSibling);
                }
            } else {
                if (sauceRow) {
                    sauceRow.remove();
                    delete cart.sauce;
                }
            }
            updateCartDisplay();
        }

        function adjustSauceQuantity(change) {
            const sauceQuantityInput = document.getElementById("sauceQuantity");
            let currentValue = parseInt(sauceQuantityInput.value, 10) || 0;

            currentValue += change;
            if (currentValue < 0) {
                currentValue = 0;
            } else if (currentValue > 2) {
                currentValue = 2;
                alert("You can select up to 2 sauces per flavor.");
            }

            sauceQuantityInput.value = currentValue;
            updateSauceCart();
        }



        function updateSauceCart() {
            const sauceChoice = document.getElementById("sauceChoice").value;
            const sauceQuantity = parseInt(document.getElementById("sauceQuantity").value, 10) || 0;

            if (sauceChoice !== "None" && sauceQuantity > 0) {
                cart.sauce = {
                    name: sauceChoice,
                    quantity: sauceQuantity,
                    price: 0
                };
            } else {
                delete cart.sauce;
            }
            updateCartDisplay();
        }

        function calculateFee(totalPrice) {
            if (totalPrice <= 10) {
                return 4.00;
            } else if (totalPrice <= 20) {
                return 5.50;
            } else if (totalPrice <= 30) {
                return 6.00;
            } else if (totalPrice <= 40) {
                return 8.00;
            } else {
                return 10.00;
            }
        }

        function updateTotalCost() {
            let subTotal = 0;

            // Iterate through the cart to calculate the subtotal
            for (let itemKey in cart) {
                const itemData = cart[itemKey];

                if (itemData.quantity !== undefined && itemData.price !== undefined) {
                    subTotal += itemData.quantity * itemData.price;
                } else {
                    for (let size in itemData) {
                        const sizeData = itemData[size];
                        subTotal += sizeData.quantity * sizeData.price;
                    }
                }
            }

            const fee = calculateFee(subTotal);
            const total = subTotal + fee;

            const totalCostElement = document.getElementById('totalCost');

            // Only display totals if the subtotal is greater than 0
            if (subTotal > 0) {
                totalCostElement.innerHTML = `
            <div style="display: flex; justify-content: space-between;">
                <span>Subtotal</span> <span>$${subTotal.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Delivery Fee</span> <span>$${fee.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-weight: bold;">
                <span>Total</span> <span>$${total.toFixed(2)}</span>
            </div>
            <textarea id="specialInstructions" name="specialInstructions" rows="4" cols="50" 
                      placeholder="Enter any special requests (e.g., no pickles, extra sauce)"></textarea>
        `;
            } else {
                totalCostElement.innerHTML = ''; // Clear the total cost display when cart is empty
            }
        }


        // Ensure the textarea is empty on page load
        document.addEventListener("DOMContentLoaded", function () {
            const specialInstructions = document.getElementById("specialInstructions");
            specialInstructions.value = "";  // Ensure the textarea is empty on load
        });

        async function submitOrder(event) {
            event.preventDefault();

            const name = document.querySelector('input[placeholder="Enter Name"]').value.trim();
            const residence = document.getElementById("Dorm").value;
            const phoneNumber = document.querySelector('input[placeholder="Enter Phone Number"]').value.trim();

            if (!name || !residence || !phoneNumber) {
                alert("Please fill out your name, residence, and phone number.");
                return;
            }

            let items = [];
            for (let itemKey in cart) {
                const itemData = cart[itemKey];

                if (itemData.quantity !== undefined && itemData.quantity > 0) {
                    items.push({
                        name: formatItemName(itemKey),
                        price: itemData.price,
                        quantity: itemData.quantity
                    });
                } else {
                    for (let size in itemData) {
                        const sizeData = itemData[size];
                        if (sizeData.quantity > 0) {
                            items.push({
                                name: `${size} ${formatItemName(itemKey)}`,
                                price: sizeData.price,
                                quantity: sizeData.quantity
                            });
                        }
                    }
                }
            }

            if (items.length === 0) {
                alert("Your cart is empty!");
                return;
            }

            let orderDetails = [];
                for (let itemKey in cart) {
                    const itemData = cart[itemKey];
                    if (itemData.quantity > 0) {
                        orderDetails.push(`${itemData.quantity}x ${formatItemName(itemKey)}`);
                    }
                }

                // Store email data in sessionStorage
                sessionStorage.setItem("emailData", JSON.stringify({
                    to_email: "willy2godelivery@gmail.com",
                    name: name,
                    residence: residence,
                    phone: phoneNumber,
                    special_instructions: document.getElementById("specialInstructions").value.trim() || "None", // Get value from textarea
                    order_details: orderDetails.join("\n"), // Convert order details array into a newline-separated string
                    total_cost: document.getElementById("totalCost").innerText.trim() // Convert total cost to plain text
                }));



            // Calculate delivery fee
            let subTotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
            function calculateFee(totalPrice) {
                if (totalPrice <= 10) return 4.00;
                else if (totalPrice <= 20) return 5.50;
                else if (totalPrice <= 30) return 6.00;
                else if (totalPrice <= 40) return 8.00;
                else return 10.00;
            }
            const deliveryFee = calculateFee(subTotal);
            const total = subTotal + deliveryFee;

            console.log("Subtotal:", subTotal);
            console.log("Delivery Fee:", deliveryFee);
            console.log("Total Cost (to be sent to Stripe):", total);

            try {
                const response = await fetch("https://willy2go.onrender.com/create-checkout-session", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ items, delivery_fee: deliveryFee }), // Send delivery fee
                });

                const session = await response.json();
                if (session.url) {
                    window.location.href = session.url; // Redirect to Stripe Checkout
                } else {
                    throw new Error("Stripe session URL missing");
                }
            } catch (error) {
                console.error("Payment error:", error);
                alert("Failed to proceed with payment.");
            }
        }



    </script>

</body>

</html>